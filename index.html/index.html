<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>QPMC Tournament Registration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
      margin: 0;
    }
    h2, h3 {
      text-align: center;
      color: #ffcc00;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      background: #1c1c1c;
      padding: 15px 10px;
      border-bottom: 2px solid #ffcc00;
    }
    header img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ffcc00;
    }
    #cover {
      display: block;
      margin: 20px auto;
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid #ffcc00;
    }
    #entryCount {
      text-align: center;
      margin-bottom: 10px;
      font-size: 16px;
    }
    .teams {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .team {
      background: #1c1c1c;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
      position: relative;
    }
    .team img.logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
    }
    .players {
      margin-top: 10px;
      font-size: 12px;
      text-align: left;
      max-height: 100px;
      overflow-y: auto;
    }
    .player-entry {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 2px 0;
    }
    .player-entry img {
      width: 20px;
      height: 20px;
      border-radius: 50%;
    }
    .locked {
      opacity: 0.5;
      pointer-events: none;
    }
    .locked::after {
      content: "üö´";
      font-size: 30px;
      position: absolute;
      top: 35%;
      left: 45%;
    }
    .form-container {
      max-width: 450px;
      margin: 20px auto;
      background: #1c1c1c;
      padding: 20px;
      border-radius: 10px;
      display: none;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: none;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border: none;
      border-radius: 5px;
      background: #ffcc00;
      cursor: pointer;
      font-weight: bold;
    }
    #avatarPreview {
      display: block;
      margin: 10px auto;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ffcc00;
    }
    video {
      width: 100%;
      max-height: 200px;
      margin-top: 10px;
    }
    .success {
      text-align: center;
      display: none;
      margin-top: 20px;
    }
    .tick {
      font-size: 80px;
      color: lime;
      animation: pop 0.6s ease forwards;
    }
    @keyframes pop {
      from { transform: scale(0); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .closed {
      text-align: center;
      color: red;
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
    }
    .leave-btn {
      background: red;
      margin-top: 10px;
    }

    /* ‚úÖ Social Links */
    .social-links {
      position: fixed;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }
    .social-links a {
      color: #ffcc00;
      text-decoration: none;
      font-size: 22px;
      transition: 0.3s;
    }
    .social-links a:hover {
      color: #fff;
      transform: scale(1.2);
    }

    /* ‚úÖ Footer */
    footer {
      text-align: center;
      margin-top: 30px;
      padding: 15px;
      background: #1c1c1c;
      border-top: 2px solid #ffcc00;
      font-size: 14px;
    }
    footer a {
      color: #ffcc00;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- ‚úÖ Header with Logo -->
  <header>
    <img src="Logo.png" alt="QPMC Logo">
    <h2>üèÜ QPMC Tournament Registration</h2>
  </header>

  <!-- ‚úÖ Cover Image -->
  <img id="cover" src="Cover.png" alt="Tournament Cover">

  <div id="entryCount">Entries: 0 / 300</div>
  <div class="teams" id="teams"></div>
  <div id="closedMsg" class="closed" style="display:none;">
    üö´ Registration Closed (300 players reached)
  </div>

  <div class="form-container" id="formContainer">
    <h3>Join Team</h3>
    <form id="registrationForm">
      <input type="hidden" id="selectedTeam">
      <label>Player Name</label>
      <input type="text" id="name" required>
      <label>QPMC ID</label>
      <input type="text" id="qpmcId" required>
      <label>Discord ID</label>
      <input type="text" id="discordId" required>
      <label>WhatsApp Number</label>
      <input type="text" id="whatsapp" required>
      <label>Address</label>
      <input type="text" id="address" required>

      <label>Upload Avatar / Drag & Drop</label>
      <input type="file" id="avatarUpload" accept="image/*">
      <img id="avatarPreview" src="https://via.placeholder.com/100" alt="Avatar Preview">

      <label>Or Take a Photo</label>
      <video id="camera" autoplay playsinline></video>
      <button type="button" onclick="capturePhoto()">üì∏ Capture</button>

      <button type="submit">Register</button>
    </form>
    <button class="leave-btn" id="leaveBtn" style="display:none;">Leave Team</button>
  </div>

  <div class="success" id="successBox">
    <div class="tick">‚úî</div>
    <h3>Registration Successful!</h3>
    <p>
      Group stage is from 13-17th Feb 2026<br>
      Grand Final is from 26-28th Feb<br>
      Venue: Al Jannat Marriage Hall Quetta
    </p>
  </div>

  <audio id="successSound">
    <source src="https://www.soundjay.com/buttons/sounds/button-3.mp3" type="audio/mpeg">
  </audio>

<!-- ‚úÖ Social Links on Left (using image logos) -->
<div class="social-links">
  <a href="https://www.tiktok.com/@darkglitch54" target="_blank" title="TikTok">
    <img src="tiktok.png" alt="TikTok" width="28" height="28">
  </a>
  <a href="https://www.instagram.com/darkglitch54/?next=%2F" target="_blank" title="Instagram">
    <img src="download.png" alt="Instagram" width="28" height="28">
  </a>
  <a href="https://www.facebook.com/hamza.paracha.886454" target="_blank" title="Facebook">
    <img src="facebook.png" alt="Facebook" width="28" height="28">
  </a>
  <a href="https://discord.com/users/gaimingyt_54_69622" target="_blank" title="Discord">
    <img src="discord.png" alt="Discord" width="28" height="28">
  </a>
</div>


  <!-- ‚úÖ Footer -->
  <footer>
    Designed by 
    <a href="https://www.adzensei.com" target="_blank">www.adzensei.com</a> & 
    <a href="https://www.cityexpress.com.pk" target="_blank">www.cityexpress.com.pk</a>
  </footer>

  <!-- ‚úÖ EmailJS + Existing Script (unchanged) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    emailjs.init("AqY7Bd_nojhZexE8k");

    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzQBN2z_ML9dS3NwDKObov0Xy_DQ0L2BiFi03vHNMNua_yMfZOuXBN-RELF5j3Sj9Uj/exec";
    const teamNames = [
      "QPMC Titans","Desert Eagles","Shadow Hunters","Iron Gladiators","Storm Breakers",
      "Desert Vipers","Night Hawks","Warzone Legends","Crimson Raiders","Ghost Reapers",
      "Steel Panthers","Inferno Squad","Black Cobra","Savage Wolves","Golden Spartans",
      "Thunder Kings","Silent Assassins","Deadly Snipers","Phoenix Flames","Toxic Venom",
      "Frost Dragons","Dark Empire","Storm Wolves","Battle Hawks","Elite Hunters"
    ];
    let teamsData = JSON.parse(localStorage.getItem("qpmcTeams")) || {};
    teamNames.forEach(t => { if (!teamsData[t]) teamsData[t] = []; });
    let currentPlayer = JSON.parse(localStorage.getItem("currentPlayer")) || null;

    const teamsDiv = document.getElementById("teams");
    const formContainer = document.getElementById("formContainer");
    const form = document.getElementById("registrationForm");
    const selectedTeamInput = document.getElementById("selectedTeam");
    const successBox = document.getElementById("successBox");
    const entryCount = document.getElementById("entryCount");
    const closedMsg = document.getElementById("closedMsg");
    const leaveBtn = document.getElementById("leaveBtn");
    const successSound = document.getElementById("successSound");
    const avatarPreview = document.getElementById("avatarPreview");
    const avatarUpload = document.getElementById("avatarUpload");
    const camera = document.getElementById("camera");
    let cameraStream;

    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          cameraStream = stream;
          camera.srcObject = stream;
        })
        .catch(err => console.log("Camera access denied:", err));
    }

    function capturePhoto() {
      const canvas = document.createElement("canvas");
      canvas.width = camera.videoWidth;
      canvas.height = camera.videoHeight;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(camera, 0, 0, canvas.width, canvas.height);
      const imageUrl = canvas.toDataURL("image/png");
      avatarPreview.src = imageUrl;
      avatarPreview.dataset.captured = imageUrl;
    }

    avatarUpload.addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          avatarPreview.src = ev.target.result;
          avatarPreview.dataset.captured = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    function totalEntries() {
      return Object.values(teamsData).reduce((a, b) => a + b.length, 0);
    }

    function renderTeams() {
      const total = totalEntries();
      entryCount.innerText = `Entries: ${total} / 300`;
      closedMsg.style.display = total >= 300 ? "block" : "none";

      teamsDiv.innerHTML = "";
      teamNames.forEach((team, i) => {
        const div = document.createElement("div");
        div.className = "team";
        if (teamsData[team].length >= 6) div.classList.add("locked");
        let playersList = teamsData[team].map(p => `
          <div class="player-entry">
            <img src="${p.avatar}" alt="A"> <span>${p.name}</span>
          </div>`).join("");
        div.innerHTML = `
          <img class="logo" src="team${i+1}.jpg" alt="${team}">
          <p>${team}</p>
          <small>${teamsData[team].length}/6</small>
          <div class="players">${playersList}</div>
        `;
        div.addEventListener("click", () => selectTeam(team));
        teamsDiv.appendChild(div);
      });
    }

    function selectTeam(team) {
      if (totalEntries() >= 300) return;
      selectedTeamInput.value = team;
      formContainer.style.display = "block";
      leaveBtn.style.display = currentPlayer && currentPlayer.team === team ? "block" : "none";
    }

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      const team = selectedTeamInput.value;
      if (teamsData[team].length >= 6) {
        alert("üö´ This team is full!");
        return;
      }
      if (totalEntries() >= 300) {
        alert("üö´ Registration Closed!");
        return;
      }
      const player = {
        name: document.getElementById("name").value,
        id: document.getElementById("qpmcId").value,
        discord: document.getElementById("discordId").value,
        whatsapp: document.getElementById("whatsapp").value,
        address: document.getElementById("address").value,
        avatar: avatarPreview.dataset.captured || "https://via.placeholder.com/100",
        team
      };
      teamsData[team].push(player);
      currentPlayer = { ...player, team };
      localStorage.setItem("qpmcTeams", JSON.stringify(teamsData));
      localStorage.setItem("currentPlayer", JSON.stringify(currentPlayer));
      fetch(WEB_APP_URL, { method: "POST", body: JSON.stringify(player) });
      emailjs.send("service_820z1bk", "template_wwu0n48", player);
      successBox.style.display = "block";
      formContainer.style.display = "none";
      successSound.play();
      form.reset();
      avatarPreview.src = "https://via.placeholder.com/100";
      delete avatarPreview.dataset.captured;
      renderTeams();
    });

    leaveBtn.addEventListener("click", () => {
      if (!currentPlayer) return;
      const team = currentPlayer.team;
      teamsData[team] = teamsData[team].filter(p => p.id !== currentPlayer.id);
      localStorage.setItem("qpmcTeams", JSON.stringify(teamsData));
      currentPlayer = null;
      localStorage.removeItem("currentPlayer");
      alert("‚ùå You left the team.");
      formContainer.style.display = "none";
      renderTeams();
    });

    renderTeams();
  </script>
</body>
</html>
